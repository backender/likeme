<!DOCTYPE html>
<html xmlns:fb="http://www.facebook.com/2008/fbml">
    <head>
        <meta charset="UTF-8" />
        <link href='http://fonts.googleapis.com/css?family=Ubuntu:300,400,500' rel='stylesheet' type='text/css'>
        <title>{% block title %}Welcome!{% endblock %}</title>
        {% block stylesheets %}
        	{% stylesheets filter='cssrewrite'
			'bundles/likemesystem/css/ui-lightness/jquery-ui-1.8.23.custom.css'
			'bundles/likemesystem/css/main.css'
			%}
			
			<link href="{{ asset_url }}" rel="stylesheet" type="text/css">
				
			{% endstylesheets %}
			
        {% endblock %}
        <link rel="shortcut icon" href="{{ asset('favicon.ico') }}" />
        
    </head>
    <body>
    	<div id="container">
      {{ facebook_initialize({'xfbml': true, 'fbAsyncInit': 'onFbInit();'}) }}
      
        <h1>
        {% block head %}
        	{% if is_granted('ROLE_USER') %}
        		likeme <div style="float:right; margin-top:10px;" id="profilepic"><a href="{{ path('fos_user_profile_show') }}"><img height="40px" width="40px" src="{{ user_pictures.0.thumb }}" /></a></div>
        	{% else %}
        		likeme
        	{% endif %}
        {% endblock %}
        </h1>
        
        {% block navi %}
			{{ knp_menu_render('main') }}
        
        	{% if not is_granted('ROLE_USER') %}
        		{{ facebook_initialize({'xfbml': true, 'fbAsyncInit': 'onFbInit();'}) }}    
				{{ facebook_login_button({'autologoutlink': false}) }}
			{% endif %}
			<br /><br />
        {% endblock %}
        
            	
        {% block body %}{# layout.html.twig #}{% endblock %}
        

        {% block javascripts %}
	    
	    	{% javascripts 
	    	'bundles/likemesystem/js/jquery-1.8.0.min.js'
   			'bundles/likemesystem/js/jquery-ui-1.8.23.js'
	    	%}
	    	
	    	<script type="text/javascript" src="{{ asset_url }}"></script>
	    	
	    	<script>
			  function goLogIn(){
			      window.location = "{{ path('_security_check') }}";
			  }
			
			  function onFbInit() {
			      if (typeof(FB) != 'undefined' && FB != null ) {
			          FB.Event.subscribe('auth.statusChange', function(response) {
			              if (response.session || response.authResponse) {
			                  setTimeout(goLogIn, 500);
			              } else {
			                  window.location = "{{ path('_security_logout') }}";
			              }
			          });
			      }
			  }
			</script>
	    	
	    	{% endjavascripts %}
	    	
		{% endblock %}
    	</div>
    </body>
</html>
